<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/@microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script>
        $(document).ready(()=>{

            //AutomaticRecoonect -- movcud connection qoparsa yeniden baglayar

            const connection=new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:7065/testhub")
            .withAutomaticReconnect([1000,1000,2000,2000,2000,2000])   //[1000,2000,3000]- default refreshtime vermek olur
            .build();

            //Connection olmadiqda 
            async function start(){
                try{
                    connection.start();
                }catch(error){
                        setTimeout(()=>start(),2000);
                }
            }

            start();

            const state=$('#state');
            connection.onreconnecting(error=>{

                state.css('background-color','blue');
                state.css('color','white');
                state.html('Connection qurulur...');
                state.fadeIn(1000,()=>{
                    setTimeout(()=>{
                        state.fadeOut(1000);
                    },1000);
                });


            });
            connection.onreconnected(connectionId=>{
                state.css('background-color','green');
                state.css('color','white');
                state.html('Connection quruldu...');
                state.fadeIn(1000,()=>{
                    setTimeout(()=>{
                        state.fadeOut(1000);
                    },1000);
                });
            });
            connection.onclose(connectionId=>{
                state.css('background-color','red');
                state.css('color','white');
                state.html('Connection qurulabilmedi...');
                state.fadeIn(1000,()=>{
                    setTimeout(()=>{
                        state.fadeOut(1000);
                    },1000);
                });
            })


            $('#sendbtn').click(()=>{
                let msg=$('#msg').val();
                connection.invoke("SendMessageAsync",msg).catch(error=>console.log(error));
            });

            connection.on("ReceivedMessage",mesasage=>{
                $('#mesajlar').append(mesasage + '<br>');
            })


            

        });
    </script>
</head>
<body>

    <div id="state" style="display: none;"></div>

    <input type="text" id="msg" /><br>
    <button id="sendbtn" >Send</button>

    <div id="mesajlar"></div>
</body>
</html>